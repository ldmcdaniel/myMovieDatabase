/*------ Global Variables -------*/

"use strict";

var API_URL = "http://www.omdbapi.com/?t=";
var FIREBASE_URL = "https://nssmovies.firebaseio.com/";
var fb = new Firebase(FIREBASE_URL);
var movies;
$(".addMovie").hide();

/*------ Lookup a Movie -------*/

$(".submit").click(function () {
  var $movieSeachField = $(".movie");
  var $submitButton = $(".submit");
  $movieSeachField.prop("disabled", true);
  $submitButton.attr("disabled", true).html("Searching...");
  $(".movie-info").html("");
  $(".movie-poster").html("");
  var $input = $movieSeachField.val().split(" ").join("+");
  var url = API_URL + $input + "&y=&plot=short&r=json";
  $.get(url, function (data) {
    $(".movie-info").append("<h2 class='title'>\"" + data.Title + "\"</h2><h3 class='rating'>" + data.Rated + "</h3").append("<hr>").append("<h4>Plot: " + data.Plot + "</h4>").append("<h5>Actors: " + data.Actors + "</h5>").append("<h5>Genre: " + data.Genre + "</h5>").append("<h5>Released on " + data.Released + "</h5>").append("<h5>IMDB Rating: " + data.imdbRating + "</h5>");
    $(".movie-poster").append("<img src='" + data.Poster + "'</img>");
    $(".addMovie").show();
    $movieSeachField.prop("disabled", false);
    $submitButton.attr("disabled", false).html("Enter Movie Title");
  }); //End of .get request
}); //End of submit.click function

/*------ Add to Firebase & Table -------*/

$(".addMovie").click(function () {
  var $input = $(".movie").val().split(" ").join("+");
  var url = API_URL + $input + "&y=&plot=short&r=json";
  var postUrl = fb.child("users/" + fb.getAuth().uid + "/movies");
  $.get(url, function (data) {
    postUrl.push(data);
    $('input[type="text"]').val('');
  });
});

/*------ Syncing previous movie table -------*/

fb.onAuth(function (authData) {
  if (authData && authData.password.isTemporaryPassword) {
    window.location = '/reset_password.html';
  } else if (authData) {
    var postUrl = fb.child("users/" + fb.getAuth().uid + "/movies");
    postUrl.on("child_added", function (snapshot) {
      addMovieData(snapshot.val(), snapshot.key());
    });
  }
});

function addMovieData(data, id) {
  $(".movie-collection").prepend("<tr></tr>");
  var $target = $(".movie-collection tr:first").attr("data-id", id).append("<td><img src='" + data.Poster + "' class='poster'></td>").append("<td>" + data.Title + "</td>").append("<td>" + data.Year + "</td>").append("<td>" + data.Rated + "</td>").append("</td><td><button type='text' class='btn btn-warning delete'>Remove</button></td></tr>");
}

/*------ Delete data from Firebase & Table -------*/

$(".movie-collection").on('click', ".delete", function () {
  var $mov = $(this).closest('tr');
  var id = $mov.attr('data-id');
  $mov.remove();
  var deleteUrl = fb.child("users/" + fb.getAuth().uid + "/movies/" + id);
  deleteUrl.remove();
});

/*------ Register new user -------*/

$('.register').click(function () {
  var email = $('.login-welcome input[type="email"]').val();
  var password = $('.login-welcome input[type="password"]').val();
  fb.createUser({
    email: email,
    password: password
  }, function (err, userData) {
    if (err) {
      alert(err.toString());
    } else {
      doLogin(email, password);
    }
  });
  event.preventDefault();
});

/*------ Login to Database -------*/

$('.login-welcome form').submit(function () {
  var email = $('.login-welcome input[type="email"]').val();
  var password = $('.login-welcome input[type="password"]').val();

  doLogin(email, password);
  event.preventDefault();
});

/*------ Logout of Database -------*/

$('.logout').click(function () {
  window.location = '/myMovieDatabase';
  fb.unauth();
});

/*------ Reset password -------*/

$('.reset-password').click(function () {
  var email = $('.login-welcome input[type="email"]').val();
  fb.resetPassword({
    email: email
  }, function (err) {
    if (err) {
      alert(err.toString());
    } else {
      alert('Check your email!');
      window.location = 'myMovieDatabase/reset_password.html';
    }
  });
});

/*------ Reset password -------*/

$('.to-reset-password form').submit(function () {
  var email = fb.getAuth().password.email;
  var oldPw = $('.to-reset-password input:nth-child(1)').val();
  var newPw = $('.to-reset-password input:nth-child(2)').val();

  fb.changePassword({
    email: email,
    oldPassword: oldPw,
    newPassword: newPw
  }, function (err) {
    if (err) {
      alert(err.toString());
    } else {
      fb.unauth();
      window.location = '/myMovieDatabase';
    }
  });

  event.preventDefault();
});

$(".cancel").click(function () {
  window.location = 'myMovieDatabase/login.html';
});

/*------ Functions -------*/

function doLogin(email, password, cb) {
  fb.authWithPassword({
    email: email,
    password: password
  }, function (err, authData) {
    if (err) {
      alert(err.toString());
    } else {
      window.location = 'myMovieDatabase/home.html';
      saveAuthData(authData);
      typeof cb === 'function' && cb(authData);
    }
  });
}

function saveAuthData(authData) {
  var ref = fb.child("users/" + authData.uid + "/profile");
  ref.set(authData);
}

function clearLoginForm() {
  $('input[type="email"]').val('');
  $('input[type="password"]').val('');
}
//# sourceMappingURL=data:application/json;base64,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R0FBRywyQkFBMkIsQ0FBQztBQUM5QyxrQkFBWSxDQUFDLFFBQVEsQ0FBQyxDQUFDO0FBQ3ZCLGFBQU8sRUFBRSxLQUFLLFVBQVUsSUFBSSxFQUFFLENBQUMsUUFBUSxDQUFDLENBQUM7S0FDMUM7R0FDRixDQUFDLENBQUM7Q0FDSjs7QUFFRCxTQUFTLFlBQVksQ0FBQyxRQUFRLEVBQUU7QUFDOUIsTUFBSSxHQUFHLEdBQUcsRUFBRSxDQUFDLEtBQUssWUFBVSxRQUFRLENBQUMsR0FBRyxjQUFXLENBQUM7QUFDcEQsS0FBRyxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsQ0FBQztDQUNuQjs7QUFFRCxTQUFTLGNBQWMsR0FBSTtBQUN6QixHQUFDLENBQUMscUJBQXFCLENBQUMsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLENBQUM7QUFDakMsR0FBQyxDQUFDLHdCQUF3QixDQUFDLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxDQUFDO0NBQ3JDIiwiZmlsZSI6Im1haW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKi0tLS0tLSBHbG9iYWwgVmFyaWFibGVzIC0tLS0tLS0qL1xuXG52YXIgQVBJX1VSTCA9IFwiaHR0cDovL3d3dy5vbWRiYXBpLmNvbS8/dD1cIjtcbnZhciBGSVJFQkFTRV9VUkwgPSBcImh0dHBzOi8vbnNzbW92aWVzLmZpcmViYXNlaW8uY29tL1wiO1xudmFyIGZiID0gbmV3IEZpcmViYXNlKEZJUkVCQVNFX1VSTCk7XG52YXIgbW92aWVzO1xuJChcIi5hZGRNb3ZpZVwiKS5oaWRlKCk7XG5cbi8qLS0tLS0tIExvb2t1cCBhIE1vdmllIC0tLS0tLS0qL1xuXG4kKFwiLnN1Ym1pdFwiKS5jbGljayhmdW5jdGlvbigpIHtcbiAgdmFyICRtb3ZpZVNlYWNoRmllbGQgPSAkKFwiLm1vdmllXCIpO1xuICB2YXIgJHN1Ym1pdEJ1dHRvbiA9ICAkKFwiLnN1Ym1pdFwiKTtcbiAgJG1vdmllU2VhY2hGaWVsZC5wcm9wKFwiZGlzYWJsZWRcIiwgdHJ1ZSk7XG4gICRzdWJtaXRCdXR0b24uYXR0cihcImRpc2FibGVkXCIsIHRydWUpLmh0bWwoXCJTZWFyY2hpbmcuLi5cIik7XG4gICQoXCIubW92aWUtaW5mb1wiKS5odG1sKFwiXCIpO1xuICAkKFwiLm1vdmllLXBvc3RlclwiKS5odG1sKFwiXCIpO1xuICB2YXIgJGlucHV0ID0gJG1vdmllU2VhY2hGaWVsZFxuICAgIC52YWwoKVxuICAgIC5zcGxpdChcIiBcIilcbiAgICAuam9pbihcIitcIik7XG4gIHZhciB1cmwgPSBBUElfVVJMICsgJGlucHV0ICsgXCImeT0mcGxvdD1zaG9ydCZyPWpzb25cIjtcbiAgJC5nZXQodXJsLCBmdW5jdGlvbihkYXRhKSB7XG4gICAgJChcIi5tb3ZpZS1pbmZvXCIpXG4gICAgICAuYXBwZW5kKFwiPGgyIGNsYXNzPSd0aXRsZSc+XFxcIlwiICsgZGF0YS5UaXRsZSArIFwiXFxcIjwvaDI+PGgzIGNsYXNzPSdyYXRpbmcnPlwiICsgZGF0YS5SYXRlZCArIFwiPC9oM1wiKVxuICAgICAgLmFwcGVuZChcIjxocj5cIilcbiAgICAgIC5hcHBlbmQoXCI8aDQ+UGxvdDogXCIgKyBkYXRhLlBsb3QgKyBcIjwvaDQ+XCIpXG4gICAgICAuYXBwZW5kKFwiPGg1PkFjdG9yczogXCIgKyBkYXRhLkFjdG9ycyArIFwiPC9oNT5cIilcbiAgICAgIC5hcHBlbmQoXCI8aDU+R2VucmU6IFwiICsgZGF0YS5HZW5yZSArIFwiPC9oNT5cIilcbiAgICAgIC5hcHBlbmQoXCI8aDU+UmVsZWFzZWQgb24gXCIgKyBkYXRhLlJlbGVhc2VkICsgXCI8L2g1PlwiKVxuICAgICAgLmFwcGVuZChcIjxoNT5JTURCIFJhdGluZzogXCIgKyBkYXRhLmltZGJSYXRpbmcgKyBcIjwvaDU+XCIpXG4gICAgJChcIi5tb3ZpZS1wb3N0ZXJcIilcbiAgICAgIC5hcHBlbmQoXCI8aW1nIHNyYz0nXCIgKyBkYXRhLlBvc3RlciArIFwiJzwvaW1nPlwiKTtcbiAgICAkKFwiLmFkZE1vdmllXCIpLnNob3coKTtcbiAgICAkbW92aWVTZWFjaEZpZWxkLnByb3AoXCJkaXNhYmxlZFwiLCBmYWxzZSk7XG4gICAgJHN1Ym1pdEJ1dHRvbi5hdHRyKFwiZGlzYWJsZWRcIiwgZmFsc2UpLmh0bWwoXCJFbnRlciBNb3ZpZSBUaXRsZVwiKTtcbiAgfSkvL0VuZCBvZiAuZ2V0IHJlcXVlc3Rcbn0pLy9FbmQgb2Ygc3VibWl0LmNsaWNrIGZ1bmN0aW9uXG5cbi8qLS0tLS0tIEFkZCB0byBGaXJlYmFzZSAmIFRhYmxlIC0tLS0tLS0qL1xuXG4kKFwiLmFkZE1vdmllXCIpLmNsaWNrKGZ1bmN0aW9uKCkge1xuICB2YXIgJGlucHV0ID0gJChcIi5tb3ZpZVwiKS52YWwoKS5zcGxpdChcIiBcIikuam9pbihcIitcIik7XG4gIHZhciB1cmwgPSBBUElfVVJMICsgJGlucHV0ICsgXCImeT0mcGxvdD1zaG9ydCZyPWpzb25cIjtcbiAgdmFyIHBvc3RVcmwgPSBmYi5jaGlsZChgdXNlcnMvJHtmYi5nZXRBdXRoKCkudWlkfS9tb3ZpZXNgKTtcbiAgJC5nZXQodXJsLCBmdW5jdGlvbihkYXRhKSB7XG4gICAgcG9zdFVybC5wdXNoKGRhdGEpO1xuICAgICQoJ2lucHV0W3R5cGU9XCJ0ZXh0XCJdJykudmFsKCcnKTtcbiAgfSk7XG59KVxuXG4vKi0tLS0tLSBTeW5jaW5nIHByZXZpb3VzIG1vdmllIHRhYmxlIC0tLS0tLS0qL1xuXG5mYi5vbkF1dGgoZnVuY3Rpb24oYXV0aERhdGEpIHtcbiAgaWYgKGF1dGhEYXRhICYmIGF1dGhEYXRhLnBhc3N3b3JkLmlzVGVtcG9yYXJ5UGFzc3dvcmQpIHtcbiAgICB3aW5kb3cubG9jYXRpb24gPSAnL3Jlc2V0X3Bhc3N3b3JkLmh0bWwnXG4gIH0gZWxzZSBpZiAoYXV0aERhdGEpIHtcbiAgdmFyIHBvc3RVcmwgPSBmYi5jaGlsZChgdXNlcnMvJHtmYi5nZXRBdXRoKCkudWlkfS9tb3ZpZXNgKTtcbiAgICBwb3N0VXJsLm9uKFwiY2hpbGRfYWRkZWRcIiwgZnVuY3Rpb24oc25hcHNob3QpIHtcbiAgICAgIGFkZE1vdmllRGF0YShzbmFwc2hvdC52YWwoKSwgc25hcHNob3Qua2V5KCkpO1xuICAgIH0pXG4gIH1cbn0pXG5cbmZ1bmN0aW9uIGFkZE1vdmllRGF0YShkYXRhLCBpZCkge1xuICAkKFwiLm1vdmllLWNvbGxlY3Rpb25cIilcbiAgICAucHJlcGVuZChcIjx0cj48L3RyPlwiKTtcbiAgdmFyICR0YXJnZXQgPSAkKFwiLm1vdmllLWNvbGxlY3Rpb24gdHI6Zmlyc3RcIilcbiAgICAuYXR0cihcImRhdGEtaWRcIiwgaWQpXG4gICAgLmFwcGVuZChcIjx0ZD48aW1nIHNyYz0nXCIgKyBkYXRhLlBvc3RlciArIFwiJyBjbGFzcz0ncG9zdGVyJz48L3RkPlwiKVxuICAgIC5hcHBlbmQoXCI8dGQ+XCIgKyBkYXRhLlRpdGxlICsgXCI8L3RkPlwiKVxuICAgIC5hcHBlbmQoXCI8dGQ+XCIgKyBkYXRhLlllYXIgKyBcIjwvdGQ+XCIpXG4gICAgLmFwcGVuZChcIjx0ZD5cIiArIGRhdGEuUmF0ZWQgKyBcIjwvdGQ+XCIpXG4gICAgLmFwcGVuZChcIjwvdGQ+PHRkPjxidXR0b24gdHlwZT0ndGV4dCcgY2xhc3M9J2J0biBidG4td2FybmluZyBkZWxldGUnPlJlbW92ZTwvYnV0dG9uPjwvdGQ+PC90cj5cIik7XG59XG5cbi8qLS0tLS0tIERlbGV0ZSBkYXRhIGZyb20gRmlyZWJhc2UgJiBUYWJsZSAtLS0tLS0tKi9cblxuJChcIi5tb3ZpZS1jb2xsZWN0aW9uXCIpLm9uKCdjbGljaycsIFwiLmRlbGV0ZVwiLCBmdW5jdGlvbigpIHtcbiAgdmFyICRtb3YgPSAkKHRoaXMpLmNsb3Nlc3QoJ3RyJyk7XG4gIHZhciBpZCA9ICRtb3YuYXR0cignZGF0YS1pZCcpO1xuICAkbW92LnJlbW92ZSgpO1xuICB2YXIgZGVsZXRlVXJsID0gZmIuY2hpbGQoYHVzZXJzLyR7ZmIuZ2V0QXV0aCgpLnVpZH0vbW92aWVzLyR7aWR9YCk7XG4gIGRlbGV0ZVVybC5yZW1vdmUoKTtcbn0pXG5cbi8qLS0tLS0tIFJlZ2lzdGVyIG5ldyB1c2VyIC0tLS0tLS0qL1xuXG4kKCcucmVnaXN0ZXInKS5jbGljayhmdW5jdGlvbiAoKSB7XG4gIHZhciBlbWFpbCA9ICQoJy5sb2dpbi13ZWxjb21lIGlucHV0W3R5cGU9XCJlbWFpbFwiXScpLnZhbCgpO1xuICB2YXIgcGFzc3dvcmQgPSAkKCcubG9naW4td2VsY29tZSBpbnB1dFt0eXBlPVwicGFzc3dvcmRcIl0nKS52YWwoKTtcbiAgZmIuY3JlYXRlVXNlcih7XG4gICAgZW1haWw6IGVtYWlsLFxuICAgIHBhc3N3b3JkOiBwYXNzd29yZFxuICB9LCBmdW5jdGlvbiAoZXJyLCB1c2VyRGF0YSkge1xuICAgIGlmIChlcnIpIHtcbiAgICAgIGFsZXJ0KGVyci50b1N0cmluZygpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgZG9Mb2dpbihlbWFpbCwgcGFzc3dvcmQpO1xuICAgIH1cbiAgfSk7XG4gIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG59KTtcblxuLyotLS0tLS0gTG9naW4gdG8gRGF0YWJhc2UgLS0tLS0tLSovXG5cbiQoJy5sb2dpbi13ZWxjb21lIGZvcm0nKS5zdWJtaXQoZnVuY3Rpb24gKCkge1xuICB2YXIgZW1haWwgPSAkKCcubG9naW4td2VsY29tZSBpbnB1dFt0eXBlPVwiZW1haWxcIl0nKS52YWwoKTtcbiAgdmFyIHBhc3N3b3JkID0gJCgnLmxvZ2luLXdlbGNvbWUgaW5wdXRbdHlwZT1cInBhc3N3b3JkXCJdJykudmFsKCk7XG5cbiAgZG9Mb2dpbihlbWFpbCwgcGFzc3dvcmQpO1xuICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xufSk7XG5cbi8qLS0tLS0tIExvZ291dCBvZiBEYXRhYmFzZSAtLS0tLS0tKi9cblxuJCgnLmxvZ291dCcpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgd2luZG93LmxvY2F0aW9uID0gJy9teU1vdmllRGF0YWJhc2UnO1xuICBmYi51bmF1dGgoKTtcbn0pXG5cbi8qLS0tLS0tIFJlc2V0IHBhc3N3b3JkIC0tLS0tLS0qL1xuXG4kKCcucmVzZXQtcGFzc3dvcmQnKS5jbGljayhmdW5jdGlvbiAoKSB7XG4gIHZhciBlbWFpbCA9ICQoJy5sb2dpbi13ZWxjb21lIGlucHV0W3R5cGU9XCJlbWFpbFwiXScpLnZhbCgpO1xuICBmYi5yZXNldFBhc3N3b3JkKHtcbiAgICBlbWFpbDogZW1haWxcbiAgfSwgZnVuY3Rpb24gKGVycikge1xuICAgIGlmIChlcnIpIHtcbiAgICAgIGFsZXJ0KGVyci50b1N0cmluZygpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgYWxlcnQoJ0NoZWNrIHlvdXIgZW1haWwhJyk7XG4gICAgICB3aW5kb3cubG9jYXRpb24gPSAnbXlNb3ZpZURhdGFiYXNlL3Jlc2V0X3Bhc3N3b3JkLmh0bWwnXG4gICAgfVxuICB9KTtcbn0pO1xuXG4vKi0tLS0tLSBSZXNldCBwYXNzd29yZCAtLS0tLS0tKi9cblxuJCgnLnRvLXJlc2V0LXBhc3N3b3JkIGZvcm0nKS5zdWJtaXQoZnVuY3Rpb24gKCkge1xuICB2YXIgZW1haWwgPSBmYi5nZXRBdXRoKCkucGFzc3dvcmQuZW1haWw7XG4gIHZhciBvbGRQdyA9ICQoJy50by1yZXNldC1wYXNzd29yZCBpbnB1dDpudGgtY2hpbGQoMSknKS52YWwoKTtcbiAgdmFyIG5ld1B3ID0gJCgnLnRvLXJlc2V0LXBhc3N3b3JkIGlucHV0Om50aC1jaGlsZCgyKScpLnZhbCgpO1xuXG4gIGZiLmNoYW5nZVBhc3N3b3JkKHtcbiAgICBlbWFpbDogZW1haWwsXG4gICAgb2xkUGFzc3dvcmQ6IG9sZFB3LFxuICAgIG5ld1Bhc3N3b3JkOiBuZXdQd1xuICB9LCBmdW5jdGlvbihlcnIpIHtcbiAgICBpZiAoZXJyKSB7XG4gICAgICBhbGVydChlcnIudG9TdHJpbmcoKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGZiLnVuYXV0aCgpO1xuICAgICAgd2luZG93LmxvY2F0aW9uID0gJy9teU1vdmllRGF0YWJhc2UnO1xuICAgIH1cbiAgfSk7XG5cbiAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbn0pXG5cbiQoXCIuY2FuY2VsXCIpLmNsaWNrKGZ1bmN0aW9uKCkge1xuICB3aW5kb3cubG9jYXRpb24gPSAnbXlNb3ZpZURhdGFiYXNlL2xvZ2luLmh0bWwnXG59KVxuXG4vKi0tLS0tLSBGdW5jdGlvbnMgLS0tLS0tLSovXG5cbmZ1bmN0aW9uIGRvTG9naW4gKGVtYWlsLCBwYXNzd29yZCwgY2IpIHtcbiAgZmIuYXV0aFdpdGhQYXNzd29yZCh7XG4gICAgZW1haWw6IGVtYWlsLFxuICAgIHBhc3N3b3JkOiBwYXNzd29yZFxuICB9LCBmdW5jdGlvbiAoZXJyLCBhdXRoRGF0YSkge1xuICAgIGlmIChlcnIpIHtcbiAgICAgIGFsZXJ0KGVyci50b1N0cmluZygpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgd2luZG93LmxvY2F0aW9uID0gJ215TW92aWVEYXRhYmFzZS9ob21lLmh0bWwnO1xuICAgICAgc2F2ZUF1dGhEYXRhKGF1dGhEYXRhKTtcbiAgICAgIHR5cGVvZiBjYiA9PT0gJ2Z1bmN0aW9uJyAmJiBjYihhdXRoRGF0YSk7XG4gICAgfVxuICB9KTtcbn1cblxuZnVuY3Rpb24gc2F2ZUF1dGhEYXRhKGF1dGhEYXRhKSB7XG4gIHZhciByZWYgPSBmYi5jaGlsZChgdXNlcnMvJHthdXRoRGF0YS51aWR9L3Byb2ZpbGVgKTtcbiAgcmVmLnNldChhdXRoRGF0YSk7XG59XG5cbmZ1bmN0aW9uIGNsZWFyTG9naW5Gb3JtICgpIHtcbiAgJCgnaW5wdXRbdHlwZT1cImVtYWlsXCJdJykudmFsKCcnKTtcbiAgJCgnaW5wdXRbdHlwZT1cInBhc3N3b3JkXCJdJykudmFsKCcnKTtcbn1cbiJdfQ==